name: Release
run-name: ${{github.actor}} is releasing ${{github.event_name}} for ${{github.repository}}

on:
  push:
    branches: [development, main]
  pull_request:
    branches: [development, main]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

  check-pnpm-version:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Check pnpm version
        id: check_pnpm
        run: pnpm --version
        continue-on-error: true  #? Не останавливать выполнение, если команда завершилась с ошибкой

  install-pnpm:
    runs-on: ubuntu-latest
    needs: [check-pnpm-version]
    if: ${{ needs['check-pnpm-version'].result == 'failure' }}  #? Устанавливать только если предыдущая задача завершилась ошибкой
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install pnpm
        run: npm install -g pnpm
